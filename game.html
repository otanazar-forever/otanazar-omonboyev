<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cyber Tennis - Ultimate Edition Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Syncopate:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --cyan: #00f2ff;
            --pink: #ff007b;
            --bg: #010103;
        }

        body {
            margin: 0; padding: 0;
            background: var(--bg);
            color: #fff;
            font-family: 'Syncopate', sans-serif;
            display: flex; flex-direction: column; align-items: center;
            height: 100vh; overflow: hidden; touch-action: none;
        }

        body::after {
            content: " ";
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.15) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.05), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.05));
            background-size: 100% 3px, 3px 100%;
            pointer-events: none; z-index: 50;
        }

        .ui-header {
            width: 100%; padding: 5px 0;
            display: flex; flex-direction: column; align-items: center;
            z-index: 100;
        }

        .difficulty-panel { display: flex; gap: 5px; margin-bottom: 5px; align-items: center; flex-wrap: wrap; justify-content: center; }
        
        .diff-btn {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #555; padding: 6px 10px;
            font-family: 'Syncopate'; font-size: 7px; font-weight: 700;
            cursor: pointer; transition: 0.3s; letter-spacing: 1px;
            text-decoration: none;
        }

        .scoreboard {
            display: flex; align-items: center; gap: 20px;
            padding: 8px 30px;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(0, 242, 255, 0.2);
            backdrop-filter: blur(10px);
            clip-path: polygon(5% 0, 95% 0, 100% 50%, 95% 100%, 5% 100%, 0 50%);
        }

        .score { font-size: 1.2rem; font-weight: 700; }

        #game-container {
            position: relative;
            width: 95vw;
            max-width: 1000px;
            max-height: 65vh; 
            aspect-ratio: 16 / 8;
            margin-top: 5px;
            border: 3px solid #00f2ff;
            border-radius: 5px;
            background: #000;
            box-shadow: 0 0 20px rgba(0, 242, 255, 0.2);
        }

        canvas { 
            width: 100%; 
            height: 100%; 
            display: block; 
            touch-action: none;
        }

        /* --- ANDROID UCHUN YANGI QO'SHILGAN CSS --- */
        .mobile-joystick-area {
            width: 85vw;
            max-width: 500px;
            height: 70px;
            margin-top: 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--cyan);
            border-radius: 35px;
            position: relative;
            display: flex;
            align-items: center;
            z-index: 1000;
        }

        .joystick-handle {
            width: 60px;
            height: 60px;
            background: var(--cyan);
            border-radius: 50%;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 0 0 20px var(--cyan);
            cursor: pointer;
            touch-action: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #000;
            font-weight: bold;
        }

        .joystick-label {
            width: 100%;
            text-align: center;
            font-size: 7px;
            color: var(--cyan);
            opacity: 0.4;
            letter-spacing: 3px;
            pointer-events: none;
        }

        @media (min-width: 768px) {
            .mobile-joystick-area { display: none; } /* Kompyuterda ko'rinmaydi */
        }
        /* ----------------------------------------- */

        @media (min-width: 768px) {
            .ui-header { padding: 10px 0; }
            .diff-btn { font-size: 8px; padding: 8px 15px; }
            .score { font-size: 2rem; }
            #game-container { border-width: 4px; }
        }

        .diff-btn.active { border-color: var(--cyan); color: #fff; background: rgba(0, 242, 255, 0.1); box-shadow: 0 0 15px rgba(0, 242, 255, 0.3); }
        .back-link { border-color: var(--pink) !important; color: var(--pink) !important; }
        #userScore { color: var(--cyan); text-shadow: 0 0 20px var(--cyan); }
        #comScore { color: var(--pink); text-shadow: 0 0 20px var(--pink); }
        .glitch-active { animation: glitch 0.2s linear; }
        @keyframes glitch { 0% { transform: translate(0); } 33% { transform: translate(-5px, 2px) skew(5deg); } 66% { transform: translate(5px, -2px) skew(-5deg); } 100% { transform: translate(0); } }
        .shake { animation: shake 0.2s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 0%, 100% { transform: translate(0,0); } 20% { transform: translate(6px, -6px); } 40% { transform: translate(-6px, 6px); } 60% { transform: translate(6px, 6px); } 80% { transform: translate(-6px, -6px); } }
        #overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.96); display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 200; backdrop-filter: blur(12px); }
        .reboot-btn { background: none; border: 1px solid var(--cyan); color: var(--cyan); padding: 12px 35px; font-family: 'Syncopate'; font-size: 9px; cursor: pointer; transition: 0.3s; letter-spacing: 4px; }
        .reboot-btn:hover { background: var(--cyan); color: #000; box-shadow: 0 0 30px var(--cyan); }
    </style>
</head>
<body>

<div class="ui-header" id="header-ui">
    <div class="difficulty-panel">
        <button class="diff-btn" id="easy" onclick="setDiff(0.06, 'easy')">LVL_01</button>
        <button class="diff-btn active" id="med" onclick="setDiff(0.12, 'med')">LVL_02</button>
        <button class="diff-btn" id="hard" onclick="setDiff(0.2, 'hard')">LVL_03</button>
        <a href="index.html" class="diff-btn back-link">TERMINATE</a>
    </div>

    <div class="scoreboard" id="score-box">
        <div class="score" id="userScore">0</div>
        <div id="status-tag" style="font-size: 7px; opacity: 0.4; letter-spacing: 2px;">LINK_ESTABLISHED</div>
        <div class="score" id="comScore">0</div>
    </div>
</div>

<div id="game-container">
    <canvas id="pong"></canvas>
    <div id="overlay">
        <div id="status-text" style="font-size: 1.5rem; margin-bottom: 25px; letter-spacing: 8px;">SYSTEM_REBOOT</div>
        <button class="reboot-btn" onclick="resetGame()">INITIALIZE_NEW_CYCLE</button>
    </div>
</div>

<div class="mobile-joystick-area" id="joy-track">
    <div class="joystick-label">CONTROL_ROLLER</div>
    <div class="joystick-handle" id="joy-handle">:::</div>
</div>
<script>
    const canvas = document.getElementById("pong");
    const ctx = canvas.getContext("2d");
    const container = document.getElementById("game-container");
    const headerUI = document.getElementById("header-ui");
    
    // Joystick elementlari
    const joyHandle = document.getElementById("joy-handle");
    const joyTrack = document.getElementById("joy-track");

    const W = 1200, H = 600;
    canvas.width = W; canvas.height = H;

    const boardImg = new Image();
    boardImg.src = 'board.jpg';
    let imgReady = false;
    boardImg.onload = () => imgReady = true;

    let aiLevel = 0.12, gameRunning = true, targetScore = 15;
    let ball = { x: W/2, y: H/2, r: 10, speed: 11, vX: 11, vY: 11 };
    let user = { x: 30, y: H/2 - 70, w: 12, h: 140, score: 0, flash: 0 };
    let com = { x: W - 42, y: H/2 - 70, w: 12, h: 140, score: 0, flash: 0 };
    let trails = [], particles = [], rotation = 0;

    // --- ANDROID UCHUN YANGI QO'SHILGAN JS FUNKSIYA ---
    function updateJoystick(e) {
        const rect = joyTrack.getBoundingClientRect();
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        let pos = (clientX - rect.left) / rect.width;
        pos = Math.max(0, Math.min(1, pos));
        
        // Tutqichni harakatlantirish
        joyHandle.style.left = (pos * 100) + "%";
        
        // Raketkani harakatlantirish (0-1 nisbatni o'yin balandligiga uramiz)
        user.y = pos * (H - user.h);
    }

    joyTrack.addEventListener("touchmove", (e) => {
        updateJoystick(e);
        e.preventDefault();
    }, {passive: false});

    joyTrack.addEventListener("mousemove", (e) => {
        if(e.buttons === 1) updateJoystick(e);
    });
    // -------------------------------------------------

    function setDiff(level, id) {
        aiLevel = level;
        document.querySelectorAll('.diff-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        triggerGlitch();
        resetBall();
    }

    function triggerGlitch() {
        headerUI.classList.add("glitch-active");
        setTimeout(() => headerUI.classList.remove("glitch-active"), 250);
    }

    function handleMove(e) {
        const rect = canvas.getBoundingClientRect();
        const clientY = e.touches ? e.touches[0].clientY : e.clientY;
        const scaleY = H / rect.height;
        user.y = (clientY - rect.top) * scaleY - user.h / 2;
        if(user.y < 0) user.y = 0; if(user.y > H - user.h) user.y = H - user.h;
    }

    window.addEventListener("mousemove", (e) => { if(e.target === canvas) handleMove(e); });
    window.addEventListener("touchmove", e => { if(e.target === canvas) { handleMove(e); e.preventDefault(); }}, {passive: false});

    function createParticles(x, y, color) {
        for(let i=0; i<15; i++) {
            particles.push({
                x, y, vX: (Math.random()-0.5)*18, vY: (Math.random()-0.5)*18,
                life: 1, color
            });
        }
    }

    function resetBall() {
        ball.x = W/2; ball.y = H/2;
        ball.speed = 11;
        let dir = Math.random() > 0.5 ? 1 : -1;
        ball.vX = dir * ball.speed;
        ball.vY = (Math.random() > 0.5 ? 1 : -1) * ball.speed;
    }

    function resetGame() {
        user.score = 0; com.score = 0;
        document.getElementById("userScore").innerText = "0";
        document.getElementById("comScore").innerText = "0";
        document.getElementById("overlay").style.display = "none";
        gameRunning = true; resetBall();
    }

    function update() {
        if(!gameRunning) return;
        ball.x += ball.vX; ball.y += ball.vY;
        trails.push({x: ball.x, y: ball.y});
        if(trails.length > 15) trails.shift();
        rotation += 0.02;
        particles.forEach((p, i) => {
            p.x += p.vX; p.y += p.vY; p.life -= 0.03;
            if(p.life <= 0) particles.splice(i, 1);
        });
        com.y += (ball.y - (com.y + com.h/2)) * aiLevel;
        if(user.flash > 0) user.flash -= 0.08;
        if(com.flash > 0) com.flash -= 0.08;
        if(ball.y + ball.r > H || ball.y - ball.r < 0) {
            ball.vY = -ball.vY;
            createParticles(ball.x, ball.y, "#fff");
        }
        let p = (ball.x < W/2) ? user : com;
        if(ball.x + ball.r > p.x && ball.x - ball.r < p.x + p.w && 
           ball.y + ball.r > p.y && ball.y - ball.r < p.y + p.h) {
            p.flash = 1;
            container.classList.add("shake");
            if(navigator.vibrate) navigator.vibrate(20);
            setTimeout(() => container.classList.remove("shake"), 150);
            createParticles(ball.x, ball.y, ball.x < W/2 ? "#00f2ff" : "#ff007b");
            let cp = (ball.y - (p.y + p.h/2)) / (p.h/2);
            let angle = (Math.PI/4) * cp;
            let dir = (ball.x < W/2) ? 1 : -1;
            ball.speed = Math.min(ball.speed + 0.7, 25);
            ball.vX = dir * ball.speed * Math.cos(angle);
            ball.vY = ball.speed * Math.sin(angle);
        }
        if(ball.x < 0) { com.score++; scoreUpdate("comScore", com.score); resetBall(); }
        if(ball.x > W) { user.score++; scoreUpdate("userScore", user.score); resetBall(); }
    }

    function scoreUpdate(id, val) {
        document.getElementById(id).innerText = val;
        triggerGlitch();
        if(val >= targetScore) endGame(id === "userScore");
    }

    function endGame(win) {
        gameRunning = false;
        document.getElementById("overlay").style.display = "flex";
        const txt = document.getElementById("status-text");
        txt.innerText = win ? "DOMINANCE_ACHIEVED" : "SYSTEM_FAILURE";
        txt.style.color = win ? "#00f2ff" : "#ff007b";
    }

    function render() {
        ctx.fillStyle = "#010103"; ctx.fillRect(0, 0, W, H);
        if(imgReady) {
            ctx.save(); ctx.globalAlpha = 0.08;
            ctx.drawImage(boardImg, 0, 0, W, H);
            ctx.restore();
        }
        ctx.strokeStyle = "rgba(0, 242, 255, 0.1)";
        ctx.beginPath();
        ctx.arc(W/2, H/2, 60, rotation, rotation + Math.PI*1.5);
        ctx.stroke();
        ctx.strokeStyle = "rgba(0, 242, 255, 0.04)";
        ctx.lineWidth = 1;
        for(let i=0; i<W; i+=60) { ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i,H); ctx.stroke(); }
        trails.forEach((t, i) => {
            ctx.fillStyle = `rgba(255, 255, 255, ${i/35})`;
            ctx.beginPath(); ctx.arc(t.x, t.y, ball.r * (i/trails.length), 0, Math.PI*2); ctx.fill();
        });
        particles.forEach(p => {
            ctx.fillStyle = p.color; ctx.globalAlpha = p.life;
            ctx.fillRect(p.x, p.y, 4, 4);
        });
        ctx.globalAlpha = 1;
        ctx.shadowBlur = 25; ctx.shadowColor = "#00f2ff";
        ctx.fillStyle = user.flash > 0 ? `rgba(255,255,255,${user.flash})` : "#00f2ff";
        ctx.fillRect(user.x, user.y, user.w, user.h);
        ctx.shadowColor = "#ff007b";
        ctx.fillStyle = com.flash > 0 ? `rgba(255,255,255,${com.flash})` : "#ff007b";
        ctx.fillRect(com.x, com.y, com.w, com.h);
        ctx.fillStyle = "#fff"; ctx.shadowColor = "#fff"; ctx.shadowBlur = 15;
        ctx.beginPath(); ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI*2); ctx.fill();
        ctx.shadowBlur = 0;
    }

    function loop() { update(); render(); requestAnimationFrame(loop); }
    loop();
</script>
</body>
</html>